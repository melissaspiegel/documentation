[MWM](README.md) > Search Index

# Sample Web Modules Search Index

The Sample Web Modules can index any MWM Post Type. This creates a json file 
that is uploaded to our S3 Bucket to then be used for our search partial/module.

The search index is generated on a daily schedule via a cron job that runs on
our WordPress servers.

## Settings

There is a network setting that toggles the search index per post type.
On multisites, look for the "MWM" options page on the Network Admin Dashboard. For single sites, the same options page will be available on the Admin dashboard.

Link: https://sampledev.wpengine.test/wp-admin/network/admin.php?page=swm-network-options 

## File Structure

The code behind search indexing is all located within `Includes/Search`.

```text
csv/                   Data in CSV format, uploaded to IQL index.
  iupload.sh           Shell script used to upload to IQL.
  .gitignore           All exported files are generated by cron jobs and ignored by git.

json/                  Data in JSON format for site search, uploaded to S3.
  .gitignore           All exported files are generated by cron jobs and ignored by git.

SearchIql.php          Class responsible for transposing MWM data into IQL index data.
SearchPublisher.php    Class responsible for transposing MWM data into search index data.

```

## Setup

1. Add the following constants to your wp-config.php file:
```php
define('USE_LOCAL_SEARCH_RESULTS', true); // Tells the frontend to use generated local JSON files instead of S3
define( 'CRON_SEARCH_INDEX_START', 'today 21:00:00' );  // Based on UTC Time
define( 'CRON_SEARCH_INDEX_RECURRENCE', 'daily' );      // How often you wish to run
define( 'INDEED_SEARCH_S3_PATH', '/sample_search/' );   // Where to save the files in the S3 Bucket
define( 'INDEED_SEARCH_S3_BUCKET', 'tophat-cms-prod' ); // S3 Bucket to use
define( 'AWS_REGION', 'us-east-1' );                    // S3 Region
define( 'AWS_ACCESS_KEY_ID', '....' );                  // AWS Key ID
define( 'AWS_SECRET_ACCESS_KEY', '...' );               // AWS Access Key
define( 'AWS_DISTRIBUTION_ID', '...' );                 // AWS Distribution ID
```
> AWS S3 Values can be found in our lastpass group.

2. **De-Activate and Activate the MWM Plugin**.  This will create the hook for the cron job.

3. Verify that the cron job is set up by running the following command on the server:
```bash
> wp cron event list
```
You should see the `swm_search_index` hook and the next scheduled start time.

## Running

Once the cron job has run, it will create files for each post type and locale.  The files will
be saved in the folder `Includes\Search\json\` with the format `sample_search_index_<post_type>_<locale>.json`.
> Example: sample_search_index_recruiter_hub_pt_en_us.json

The same files will be uploaded to the S3 Bucket under the folder defined with `INDEED_SEARCH_S3_PATH`.  

> For each file uploaded they will also have their cache invalidated.
